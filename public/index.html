<!DOCTYPE html>
<html>
 
<head>
  <meta charset="UTF-8">
  <title>LineChartサンプル</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
</head>
 
<body>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyCA2Gi83b2KVKcrf5GCdQ4ZIomUSJMYsI8",
    authDomain: "open-marusho.firebaseapp.com",
    projectId: "open-marusho",
    storageBucket: "open-marusho.appspot.com",
    messagingSenderId: "76478453915",
    appId: "1:76478453915:web:78906e53f4b4d9069c8e3e",
    measurementId: "G-WNTBVPMBPE"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>

  <h1>Weight</h1>
  <div class="chart-container" style="position: relative; width: 800px;">
    <canvas id="myLineChart"></canvas>
  </div>
  <div>
    <script type="text/javascript">

      var db = firebase.firestore();
      var dataT = [];
      var dataH = [];
      var timestamp = [];
      var strtime = [];
      function readfirestore() {

        db.collection("weight")
          .orderBy("date", "desc")
          .limit(30)
          .get().then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              dataT.push(Math.round(doc.data().value * (10 ** doc.data().unit) * 10)/10);
              // dataH.push(doc.data().humidity);
              timestamp.push(doc.data().date);
            });

            //unixtime to string
            for (let i = 0; i < timestamp.length; i++) {
              let dateTime = new Date(timestamp[i] * 1000);
              console.log(dateTime)
              strtime.push(dateTime.toLocaleString());
            }
            viewChart();
          }
          )
      };

       function viewChart() {
        var ctx = document.getElementById("myLineChart");
        var myLineChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: strtime.reverse(),
            datasets: [
              {
                label: 'Weight',
                data: dataT.reverse(),
                borderColor: "#ffa100",
                backgroundColor: "rgba(0,0,0,0)"
              }
            ],
          },
          options: {
            title: {
              display: false,
              text: '体重'
            },
            scales: {
              xAxes: [{
              type: 'time',
              time: {
                unit: 'day'
              }
            }],
              yAxes: [{
                ticks: {
                  suggestedMax: 56,
                  suggestedMin: 50,
                  stepSize: 1,
                  callback: function (value, index, values) {
                    return value + ''
                  }
                }
              }]
            },
          }
        });
      };
 
    readfirestore();
 
    </script>
 
  </div>
</body>
 
</html>
